<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>mp03 – STA 9750 Fall 2024 - Jason Amey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="shortcut icon" href="images/favicon.ico">


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Fall 2024 - Jason Amey</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">




<!-- library(readr) -->
<!-- library(dplyr) -->
<!-- library(tidyr) -->
<p>This project uses packages <code>readr</code>, <code>dplyr</code>, <code>tidy</code></p>
<!-- The MIT Election Data Science Lab collects votes from all biennial congressional races in all 50 states here. Download this data as a CSV file using your web browser. Note that you will need to provide your contact info and agree to cite this data set in your final report.4 Make sure to include this citation! -->
<!-- Additionally, download statewide presidential vote counts from 1976 to 2022 here. As before, it will likely be easiest to download this data by hand using your web browser. -->
<!-- get_imdb_file <- function(fname){ -->
<!--     BASE_URL <- "https://datasets.imdbws.com/" -->
<!--     fname_ext <- paste0(fname, ".tsv.gz") -->
<!--     if(!file.exists(fname_ext)){ -->
<!--         FILE_URL <- paste0(BASE_URL, fname_ext) -->
<!--         download.file(FILE_URL,  -->
<!--                       destfile = fname_ext) -->
<!--     } -->
<!--     as.data.frame(readr::read_tsv(fname_ext, lazy=FALSE)) -->
<!-- } -->
<!-- NAME_BASICS      <- get_imdb_file("name.basics") -->
<!-- install.packages("sf") -->
<!-- library(sf) -->
<!-- library(ggplot2) -->
<!-- library(readr) -->
<!-- nyc_demos <- read_csv("data/in_class/nyc_demos.csv") -->
<!-- districts <- read_sf("data/mp03/districtShapes/districts111.shp") -->
<!-- str(districts) -->
<!-- shp_data <- st_read(districts) -->
<!-- print(shp_data) -->
<!-- election_data <- read_csv("data/mp03/dataversefiles/1976-2022-house.csv") -->
<!-- glimpse(election_data) -->
<!-- ggplot(nycc, aes(geometry = geometry)) + -->
<!--   geom_sf() -->
<!-- str(shp_data) -->
<!-- children_under_5 <- nyc_demos |>  -->
<!--   filter(field == "Under 5 years") -->
<!-- glimpse(children_under_5) -->
<!-- https://cdmaps.polisci.ucla.edu/shp/districts103.zip -->
<p>What are the states to lose the most Electoral College votes since 1976?</p>
<table class="table-striped table-hover caption-top table">
<caption>Electoral Vote Losses By State (1976 vs.&nbsp;2022) </caption>
<thead>
<tr class="header">
<th>State</th>
<th>1976</th>
<th>2022</th>
<th>Change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>New York</td>
<td>41</td>
<td>28</td>
<td>-13</td>
</tr>
<tr class="even">
<td>Ohio</td>
<td>25</td>
<td>17</td>
<td>-8</td>
</tr>
<tr class="odd">
<td>Pennsylvania</td>
<td>27</td>
<td>19</td>
<td>-8</td>
</tr>
<tr class="even">
<td>Illinois</td>
<td>26</td>
<td>19</td>
<td>-7</td>
</tr>
<tr class="odd">
<td>Michigan</td>
<td>21</td>
<td>15</td>
<td>-6</td>
</tr>
</tbody>
</table>
<p>What are the states to gain the most Electoral College votes since 1976?</p>
<table class="table-striped table-hover caption-top table">
<caption>Congressional District Growth By State (1976 vs.&nbsp;2022) </caption>
<thead>
<tr class="header">
<th>State</th>
<th>1976</th>
<th>2022</th>
<th>Change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Texas</td>
<td>26</td>
<td>40</td>
<td>14</td>
</tr>
<tr class="even">
<td>Florida</td>
<td>17</td>
<td>30</td>
<td>13</td>
</tr>
<tr class="odd">
<td>California</td>
<td>45</td>
<td>54</td>
<td>9</td>
</tr>
<tr class="even">
<td>Arizona</td>
<td>6</td>
<td>11</td>
<td>5</td>
</tr>
<tr class="odd">
<td>Georgia</td>
<td>12</td>
<td>16</td>
<td>4</td>
</tr>
</tbody>
</table>
<details>
<summary>
&gt;show the code
</summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>electoral_votes_76_22 <span class="ot">&lt;-</span> ELECTION_DATA <span class="sc">|&gt;</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1976</span> <span class="sc">|</span> year <span class="sc">==</span> <span class="dv">2022</span> ) <span class="sc">|&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, state) <span class="sc">|&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">votes =</span> <span class="fu">n_distinct</span>(district) <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> votes) <span class="sc">|&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">change =</span> <span class="st">`</span><span class="at">2022</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">1976</span><span class="st">`</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>electoral_votes_76_22 <span class="sc">|&gt;</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(change)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>electoral_votes_76_22 <span class="sc">|&gt;</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(change))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(election_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY19803 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1980</td>
<td>New York</td>
<td>3</td>
<td>Gregory W Carman</td>
<td>Conservative</td>
<td>0.0745</td>
<td>0.501</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>1980</td>
<td>New York</td>
<td>3</td>
<td>Gregory W Carman</td>
<td>Republican</td>
<td>0.426</td>
<td>0.501</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>1980</td>
<td>New York</td>
<td>3</td>
<td><strong>Jerome A Ambro Jr</strong></td>
<td>Democrat</td>
<td><strong>0.429</strong></td>
<td>0.475</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>1980</td>
<td>New York</td>
<td>3</td>
<td>Jerome A Ambro Jr</td>
<td>Right to Life</td>
<td>0.0455</td>
<td>0.475</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY19806 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1980</td>
<td>New York</td>
<td>6</td>
<td>John LeBoutillier</td>
<td>Conservative</td>
<td>0.0665</td>
<td>0.528</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>1980</td>
<td>New York</td>
<td>6</td>
<td>John LeBoutillier</td>
<td>Republican</td>
<td>0.423</td>
<td>0.528</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>1980</td>
<td>New York</td>
<td>6</td>
<td>John LeBoutillier</td>
<td>Right to Life</td>
<td>0.0390</td>
<td>0.528</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>1980</td>
<td>New York</td>
<td>6</td>
<td><strong>Lester L Wolff</strong></td>
<td>Democrat</td>
<td><strong>0.437</strong></td>
<td>0.472</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>1980</td>
<td>New York</td>
<td>6</td>
<td>Lester L Wolff</td>
<td>Liberal</td>
<td>0.0347</td>
<td>0.472</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY198627 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1986</td>
<td>New York</td>
<td>27</td>
<td>George C Wortley</td>
<td>Conservative</td>
<td>0.0372</td>
<td>0.497</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>1986</td>
<td>New York</td>
<td>27</td>
<td>George C Wortley</td>
<td>Republican</td>
<td>0.459</td>
<td>0.497</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>1986</td>
<td>New York</td>
<td>27</td>
<td><strong>Rosemary S Pooler</strong></td>
<td>Democrat</td>
<td><strong>0.483</strong></td>
<td>0.491</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>1986</td>
<td>New York</td>
<td>27</td>
<td>Rosemary S Pooler</td>
<td>Effective</td>
<td>0.00808</td>
<td>0.491</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY19941 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1994</td>
<td>New York</td>
<td>1</td>
<td><strong>George J Hochbrueckner</strong></td>
<td>Democrat</td>
<td><strong>0.428</strong></td>
<td>0.435</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>1994</td>
<td>New York</td>
<td>1</td>
<td>George J Hochbrueckner</td>
<td>Long Island First</td>
<td>0.00790</td>
<td>0.435</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>1994</td>
<td>New York</td>
<td>1</td>
<td>Michael P Forbes</td>
<td>Conservative</td>
<td>0.0551</td>
<td>0.492</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>1994</td>
<td>New York</td>
<td>1</td>
<td>Michael P Forbes</td>
<td>Republican</td>
<td>0.391</td>
<td>0.492</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>1994</td>
<td>New York</td>
<td>1</td>
<td>Michael P Forbes</td>
<td>Right to Life</td>
<td>0.0451</td>
<td>0.492</td>
<td>TRUE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY19961 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1996</td>
<td>New York</td>
<td>1</td>
<td>Michael P Forbes</td>
<td>Conservative</td>
<td>0.0508</td>
<td>0.495</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>1996</td>
<td>New York</td>
<td>1</td>
<td>Michael P Forbes</td>
<td>Independent</td>
<td>0.0280</td>
<td>0.495</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>1996</td>
<td>New York</td>
<td>1</td>
<td>Michael P Forbes</td>
<td>Republican</td>
<td>0.382</td>
<td>0.495</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>1996</td>
<td>New York</td>
<td>1</td>
<td>Michael P Forbes</td>
<td>Right to Life</td>
<td>0.0342</td>
<td>0.495</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>1996</td>
<td>New York</td>
<td>1</td>
<td><strong>Nora L Bredes</strong></td>
<td>Democrat</td>
<td><strong>0.398</strong></td>
<td>0.410</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>1996</td>
<td>New York</td>
<td>1</td>
<td>Nora L Bredes</td>
<td>Save Our State</td>
<td>0.0114</td>
<td>0.410</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY199630 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1996</td>
<td>New York</td>
<td>30</td>
<td><strong>Francis J Pordum</strong></td>
<td>Democrat</td>
<td><strong>0.405</strong></td>
<td>0.414</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>1996</td>
<td>New York</td>
<td>30</td>
<td>Francis J Pordum</td>
<td>Protection Party</td>
<td>0.00975</td>
<td>0.414</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>1996</td>
<td>New York</td>
<td>30</td>
<td>Jack Quinn</td>
<td>Conservative</td>
<td>0.0510</td>
<td>0.503</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>1996</td>
<td>New York</td>
<td>30</td>
<td>Jack Quinn</td>
<td>Freedom Party</td>
<td>0.00880</td>
<td>0.503</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>1996</td>
<td>New York</td>
<td>30</td>
<td>Jack Quinn</td>
<td>Independent</td>
<td>0.0398</td>
<td>0.503</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>1996</td>
<td>New York</td>
<td>30</td>
<td>Jack Quinn</td>
<td>Republican</td>
<td>0.403</td>
<td>0.503</td>
<td>TRUE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY200625 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2006</td>
<td>New York</td>
<td>25</td>
<td><strong>Dan Maffei</strong></td>
<td>Democrat</td>
<td><strong>0.443</strong></td>
<td>0.471</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>2006</td>
<td>New York</td>
<td>25</td>
<td>Dan Maffei</td>
<td>Working Families</td>
<td>0.0286</td>
<td>0.471</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>2006</td>
<td>New York</td>
<td>25</td>
<td>James T Walsh</td>
<td>Conservative</td>
<td>0.0512</td>
<td>0.486</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>2006</td>
<td>New York</td>
<td>25</td>
<td>James T Walsh</td>
<td>Independent</td>
<td>0.0339</td>
<td>0.486</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2006</td>
<td>New York</td>
<td>25</td>
<td>James T Walsh</td>
<td>Republican</td>
<td>0.401</td>
<td>0.486</td>
<td>TRUE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY200629 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2006</td>
<td>New York</td>
<td>29</td>
<td><strong>Eric J Massa</strong></td>
<td>Democrat</td>
<td><strong>0.436</strong></td>
<td>0.462</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>2006</td>
<td>New York</td>
<td>29</td>
<td>Eric J Massa</td>
<td>Working Families</td>
<td>0.0251</td>
<td>0.462</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>2006</td>
<td>New York</td>
<td>29</td>
<td>John R “Randy”</td>
<td>Conservative</td>
<td>0.0435</td>
<td>0.489</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>2006</td>
<td>New York</td>
<td>29</td>
<td>John R “Randy”</td>
<td>Independent</td>
<td>0.0243</td>
<td>0.489</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2006</td>
<td>New York</td>
<td>29</td>
<td>John R “Randy”</td>
<td>Republican</td>
<td>0.422</td>
<td>0.489</td>
<td>TRUE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY201227 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2012</td>
<td>New York</td>
<td>27</td>
<td>Chris Collins</td>
<td>Conservative</td>
<td>0.0727</td>
<td>0.489</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>2012</td>
<td>New York</td>
<td>27</td>
<td>Chris Collins</td>
<td>Republican</td>
<td>0.416</td>
<td>0.489</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2012</td>
<td>New York</td>
<td>27</td>
<td><strong>Kathleen C Hochul</strong></td>
<td>Democrat</td>
<td><strong>0.425</strong></td>
<td>0.474</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>2012</td>
<td>New York</td>
<td>27</td>
<td>Kathleen C Hochul</td>
<td>Working Families</td>
<td>0.0492</td>
<td>0.474</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY20181 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2018</td>
<td>New York</td>
<td>1</td>
<td>Lee M Zeldin</td>
<td>Conservative</td>
<td>0.0529</td>
<td>0.515</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>2018</td>
<td>New York</td>
<td>1</td>
<td>Lee M Zeldin</td>
<td>Independent</td>
<td>0.00997</td>
<td>0.515</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2018</td>
<td>New York</td>
<td>1</td>
<td>Lee M Zeldin</td>
<td>Reform Party</td>
<td>0.00181</td>
<td>0.515</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>2018</td>
<td>New York</td>
<td>1</td>
<td>Lee M Zeldin</td>
<td>Republican</td>
<td>0.450</td>
<td>0.515</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2018</td>
<td>New York</td>
<td>1</td>
<td><strong>Perry Gershon</strong></td>
<td>Democrat</td>
<td><strong>0.460</strong></td>
<td>0.474</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>2018</td>
<td>New York</td>
<td>1</td>
<td>Perry Gershon</td>
<td>Working Families</td>
<td>0.0140</td>
<td>0.474</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY201824 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2018</td>
<td>New York</td>
<td>24</td>
<td><strong>Dana Balter</strong></td>
<td>Democrat</td>
<td><strong>0.445</strong></td>
<td>0.473</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>2018</td>
<td>New York</td>
<td>24</td>
<td>Dana Balter</td>
<td>Women’s Equality</td>
<td>0.00975</td>
<td>0.473</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>2018</td>
<td>New York</td>
<td>24</td>
<td>Dana Balter</td>
<td>Working Families</td>
<td>0.0184</td>
<td>0.473</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>2018</td>
<td>New York</td>
<td>24</td>
<td>John M Katko</td>
<td>Conservative</td>
<td>0.0652</td>
<td>0.526</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2018</td>
<td>New York</td>
<td>24</td>
<td>John M Katko</td>
<td>Independent</td>
<td>0.0209</td>
<td>0.526</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>2018</td>
<td>New York</td>
<td>24</td>
<td>John M Katko</td>
<td>Reform Party</td>
<td>0.00367</td>
<td>0.526</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2018</td>
<td>New York</td>
<td>24</td>
<td>John M Katko</td>
<td>Republican</td>
<td>0.436</td>
<td>0.526</td>
<td>TRUE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY201827 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2018</td>
<td>New York</td>
<td>27</td>
<td>Chris Collins</td>
<td>Conservative</td>
<td>0.0826</td>
<td>0.491</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>2018</td>
<td>New York</td>
<td>27</td>
<td>Chris Collins</td>
<td>Independent</td>
<td>0.00732</td>
<td>0.491</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2018</td>
<td>New York</td>
<td>27</td>
<td>Chris Collins</td>
<td>Republican</td>
<td>0.401</td>
<td>0.491</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>2018</td>
<td>New York</td>
<td>27</td>
<td><strong>Nathan D McMurray</strong></td>
<td>Democrat</td>
<td><strong>0.449</strong></td>
<td>0.487</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>2018</td>
<td>New York</td>
<td>27</td>
<td>Nathan D McMurray</td>
<td>Women’s Equality</td>
<td>0.00982</td>
<td>0.487</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>2018</td>
<td>New York</td>
<td>27</td>
<td>Nathan D McMurray</td>
<td>Working Families</td>
<td>0.0284</td>
<td>0.487</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY20224 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022</td>
<td>New York</td>
<td>4</td>
<td>Anthony P D’Esposito</td>
<td>Republican</td>
<td>0.464</td>
<td>0.505</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>2022</td>
<td>New York</td>
<td>4</td>
<td>Anthony P D’Esposito</td>
<td>Conservative</td>
<td>0.0405</td>
<td>0.505</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2022</td>
<td>New York</td>
<td>4</td>
<td><strong>Laura A Gillen</strong></td>
<td>Democrat</td>
<td><strong>0.470</strong></td>
<td>0.470</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY202217 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022</td>
<td>New York</td>
<td>17</td>
<td>Michael V Lawler</td>
<td>Republican</td>
<td>0.432</td>
<td>0.493</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>2022</td>
<td>New York</td>
<td>17</td>
<td>Michael V Lawler</td>
<td>Conservative</td>
<td>0.0611</td>
<td>0.493</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2022</td>
<td>New York</td>
<td>17</td>
<td><strong>Sean Patrick Maloney</strong></td>
<td>Democrat</td>
<td><strong>0.458</strong></td>
<td>0.487</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>2022</td>
<td>New York</td>
<td>17</td>
<td>Sean Patrick Maloney</td>
<td>Working Families</td>
<td>0.0284</td>
<td>0.487</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover caption-top table">
<caption>Data for NY202222 Race</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Year</th>
<th>State</th>
<th>District</th>
<th>Candidate</th>
<th>Party</th>
<th>Percentage</th>
<th>Total Vote</th>
<th>Winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022</td>
<td>New York</td>
<td>22</td>
<td>Brandon M Williams</td>
<td>Republican</td>
<td>0.425</td>
<td>0.495</td>
<td>TRUE</td>
</tr>
<tr class="even">
<td>2022</td>
<td>New York</td>
<td>22</td>
<td>Brandon M Williams</td>
<td>Conservative</td>
<td>0.0694</td>
<td>0.495</td>
<td>TRUE</td>
</tr>
<tr class="odd">
<td>2022</td>
<td>New York</td>
<td>22</td>
<td><strong>Francis Conole</strong></td>
<td>Democrat</td>
<td><strong>0.485</strong></td>
<td>0.485</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
<details>
<summary>
&gt; show the code
</summary>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fusion_elections <span class="ot">&lt;-</span> ELECTION_DATA_HOUSE <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fusion_ticket <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> candidatevotes <span class="sc">/</span> totalvotes, <span class="at">race_id =</span> <span class="fu">paste0</span>(state_po, year, district))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>winner_percentage <span class="ot">&lt;-</span> fusion_elections <span class="sc">|&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(race_id, candidate) <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_vote =</span> <span class="fu">sum</span>(percentage)) <span class="sc">|&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>winner_percentage <span class="ot">&lt;-</span> winner_percentage <span class="sc">|&gt;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(race_id, <span class="at">name =</span> <span class="st">"race_count"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(race_count <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>race_count)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>winners_added <span class="ot">&lt;-</span> winner_percentage <span class="sc">|&gt;</span> </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(race_id) <span class="sc">|&gt;</span> </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">winner =</span> (total_vote <span class="sc">==</span> <span class="fu">max</span>(total_vote))) <span class="sc">|&gt;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>fusion_elections <span class="ot">&lt;-</span> fusion_elections <span class="sc">|&gt;</span> </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(winners_added, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"race_id"</span>, <span class="st">"candidate"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, state, state_po, district, candidate, party, percentage, race_id, total_vote, winner)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>fusion_election_IDs <span class="ot">&lt;-</span> fusion_elections <span class="sc">|&gt;</span> </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(race_id) <span class="sc">|&gt;</span> </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(percentage)) <span class="sc">|&gt;</span> </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(winner <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(race_id)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> fusion_elections <span class="sc">|&gt;</span> </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(race_id <span class="sc">%in%</span> fusion_election_IDs <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(party)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>
&gt; show the code
</summary>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>election_president_r_d <span class="ot">&lt;-</span> ELECTION_DATA_PRESIDENT <span class="sc">|&gt;</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(party_detailed <span class="sc">==</span> <span class="st">"REPUBLICAN"</span> <span class="sc">|</span> party_detailed <span class="sc">==</span> <span class="st">"DEMOCRAT"</span> )</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>sum_president_votes_r_d <span class="ot">&lt;-</span> election_president_r_d <span class="sc">|&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, state, state_po, party_detailed, candidate) <span class="sc">|&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">candidate_votes =</span> <span class="fu">sum</span>(candidatevotes, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_votes =</span> <span class="fu">max</span>(totalvotes, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># Assuming totalvotes is the same across rows for a state-year</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">paste</span>(year, state_po, party_detailed, <span class="at">sep =</span> <span class="st">"_"</span>), <span class="at">pres_percentage =</span> candidate_votes <span class="sc">/</span> total_votes) <span class="sc">|&gt;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">pres_candidate_votes =</span> candidate_votes, </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">pres_total_votes =</span> total_votes</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sum_president_votes_r_d)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>PRESIDENTIAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1976</span>, <span class="dv">2020</span>, <span class="at">by =</span> <span class="dv">4</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>total_votes_per_state <span class="ot">&lt;-</span> ELECTION_DATA_HOUSE <span class="sc">|&gt;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> PRESIDENTIAL_YEARS <span class="sc">&amp;</span> (party <span class="sc">==</span> <span class="st">"REPUBLICAN"</span> <span class="sc">|</span> party <span class="sc">==</span> <span class="st">"DEMOCRAT"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, state, state_po) <span class="sc">|&gt;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_votes =</span> <span class="fu">unique</span>(totalvotes, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">sum</span>()) <span class="sc">|&gt;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>sum_house_votes_r_d <span class="ot">&lt;-</span> ELECTION_DATA_HOUSE <span class="sc">|&gt;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(party <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DEMOCRAT"</span>, <span class="st">"REPUBLICAN"</span>) <span class="sc">&amp;</span> year <span class="sc">%in%</span> PRESIDENTIAL_YEARS) <span class="sc">|&gt;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, state, state_po, party) <span class="sc">|&gt;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">candidate_votes =</span> <span class="fu">sum</span>(candidatevotes, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(total_votes_per_state, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"state"</span>, <span class="st">"state_po"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">paste</span>(year, state_po, party, <span class="at">sep =</span> <span class="st">"_"</span>), </span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">house_percentage =</span> candidate_votes <span class="sc">/</span> total_votes</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">house_candidate_votes =</span> candidate_votes,</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">house_total_votes =</span> total_votes</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, house_candidate_votes, house_total_votes, house_percentage)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>state_vote_counts <span class="ot">&lt;-</span> sum_president_votes_r_d <span class="sc">|&gt;</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sum_house_votes_r_d, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dif =</span> house_percentage <span class="sc">-</span> pres_percentage)</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="co">#vote diff between pres and house grouped by state</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>state_vote_diff_state_score <span class="ot">&lt;-</span> state_vote_counts <span class="sc">|&gt;</span> </span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, party_detailed) <span class="sc">|&gt;</span> </span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">state_dif =</span> <span class="fu">mean</span>(dif, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(state_vote_diff_state_score)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co">#difference between parties for each election between house and president</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>state_vote_diff_pres_house <span class="ot">&lt;-</span> state_vote_counts <span class="sc">|&gt;</span> </span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, party_detailed) <span class="sc">|&gt;</span> </span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_dif =</span> <span class="fu">mean</span>(dif, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(state_vote_diff_pres_house)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>state_vote_diff_pres</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>SD <span class="ot">&lt;-</span> <span class="fu">sd</span>(state_vote_diff_pres_house<span class="sc">$</span>avg_dif)</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>MEAN <span class="ot">&lt;-</span> <span class="fu">mean</span>(state_vote_diff_pres_house<span class="sc">$</span>avg_dif)</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>state_vote_diff_total_score <span class="ot">&lt;-</span> state_vote_diff_pres_house <span class="sc">|&gt;</span> </span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> (avg_dif <span class="sc">-</span> MEAN) <span class="sc">/</span> SD) <span class="sc">|&gt;</span> </span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(score))</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(state_vote_diff_total_score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="data-prep-readjust" class="level2">
<h2 class="anchored" data-anchor-id="data-prep-readjust">DATA PREP READJUST</h2>
<details>
<summary>
&gt; show the code
</summary>
<pre><code>#data download

ELECTION_DATA_HOUSE &lt;- read_csv("data/mp03/dataversefiles/1976-2022-house.csv")
ELECTION_DATA_PRESIDENT &lt;- read_csv("data/mp03/dataversefiles/1976-2020-president.csv")


congress_shapefiles_ucla &lt;- function(start = 95, end = 112) {
  BASE_URL &lt;- "https://cdmaps.polisci.ucla.edu/shp/districts"
  
  # Create directory if it doesn't exist
  if (!dir.exists("data/mp03/congress_shapefiles")) {
    dir.create("data/mp03/congress_shapefiles", recursive = TRUE)
  }
  
  for (congress in start:end) {
    # Format congress number with leading zeros
    congress_str &lt;- sprintf("%03d", congress)
    
    # Construct URL and destination path
    file_url &lt;- paste0(BASE_URL, congress_str, ".zip")
    dest_file &lt;- paste0("data/mp03/congress_shapefiles/congress_", congress_str, "_shapefile.zip")
    
    if (!file.exists(dest_file)) {
      # Download file and check for success
      tryCatch({
        download.file(file_url, destfile = dest_file, mode = "wb")
        message("Downloaded shapefile for Congress ", congress_str)
      }, error = function(e) {
        message("Failed to download for Congress ", congress_str, ": ", e)
      })
    } else {
      message("File for Congress ", congress_str, " already exists. Skipping download.")
    }
  }
}

# Run function
congress_shapefiles_ucla(95, 98)

#####

congress_shapefiles_census &lt;- function(start_year = 2013, end_year = 2023) {
  BASE_URL &lt;- "https://www2.census.gov/geo/tiger/TIGER"
  
  # Create the download directory if it doesn’t exist
  if (!dir.exists("data/mp03/census_congress_shapefiles")) {
    dir.create("data/census_congress_shapefiles", recursive = TRUE)
  }
  
  # Determine Congress numbers based on years
  congress_numbers &lt;- seq(113, 113 + (end_year - start_year) / 2, by = 1)
  years &lt;- seq(start_year, end_year, by = 2)  # Only even years

  # Loop over the years and corresponding congress numbers
  for (i in seq_along(years)) {
    year &lt;- years[i]
    congress &lt;- congress_numbers[i]
    congress_str &lt;- sprintf("cd%d", congress)  # Format as 'cd113', 'cd114', etc.
    
    # Construct URL and destination path
    file_url &lt;- paste0(BASE_URL, year, "/CD/tl_", year, "_us_", congress_str, ".zip")
    dest_file &lt;- paste0("data/mp03/census_congress_shapefiles/tl_", year, "_us_", congress_str, ".zip")
    
    # Check if file already exists to avoid re-downloading
    if (!file.exists(dest_file)) {
      # try catch for for successful downloading
      tryCatch({
        download.file(file_url, destfile = dest_file, mode = "wb")
        print("Downloaded shapefile for ", congress_str, " (Year ", year, ")")
      }, error = function(e) {
        print("Failed to download for ", congress_str, " (Year ", year, "): ", e)
      })
    } else {
      message("File for ", congress_str, " (Year ", year, ") already exists. Skipping download.")
    }
  }
}

#Run function
congress_shapefiles_census(2013, 2023)</code></pre>
</details>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jasonamey\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>