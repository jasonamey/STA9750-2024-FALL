<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>IMDb and Me – STA 9750 Fall 2024 - Jason Amey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Fall 2024 - Jason Amey</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">IMDb and Me</h1>
<p class="subtitle lead">A deep dive into movie data with R</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>This project useses the following packagaes</em>: <code>dplyr</code>, <code>tidyr</code>, <code>stringr</code>, <code>lubridate</code>, <code>readr</code>, <code>scales</code></p>
<p><em>For details on the data used for this project see</em> <a href="#appendixA">Appendix A</a>.</p>
<p>Originating in the proto-Internet era of Usenet groups in the early 1990s, the Internet Movie Database (with its instantly recognizable acronym: IMDb) has long been an indispensable source of pop culture information. Movie buffs, film industry professionals, trivia enthusiasts, and casual web surfers all agree IMDb is the go-to resource for anyone engaged in the history of motion pictures.</p>
<section id="whats-in-the-box" class="level2">
<h2 class="anchored" data-anchor-id="whats-in-the-box">What’s in the box?</h2>
<section id="how-many-green-lights-have-been-granted-in-hollywood" class="level3">
<h3 class="anchored" data-anchor-id="how-many-green-lights-have-been-granted-in-hollywood">How many green lights have been granted in Hollywood?</h3>
<p>The “M” in the moniker obviously denotes “movie” and there are indeed <code>131,890</code> traditional “movies” in IMDb. However, many take a different interpretations as to what is - and what is not - a “movie” and IMDb maintains a separate designation for <code>tvMovie</code>.</p>
<p>The author contends that the films produced by the premium television outlet Home Box Office are significant films all-too-often overlooked by film afficianados and sure enough, HBO films are considered television films by IMDb :</p>
<pre><code>titleType   primaryTitle            startYear
tvMovie     And the Band Played On  1993

titleType   primaryTitle            startYear
tvMovie     Recount                 2008
  
titleType   primaryTitle            startYear
tvMovie     Conspiracy              2001</code></pre>
<p>Not an HBO original, but this <code>tvMovie</code> is partially credited for <a href="https://en.wikipedia.org/wiki/The_Day_After#Effects_on_policymakers">ending The Cold War</a>:</p>
<pre><code>titleType   primaryTitle    startYear
tvMovie     The Day After   1983</code></pre>
<p>The above are all noteworthy (underrated) films more than deserving to be considered and counted alongside IMDb’s critera for “movie”. If we were to count both <code>movie</code> and <code>tvMovie</code> we would find <code>146,915</code> movie titles in IMDb.</p>
<p>…Speaking of television, that “M” in IMDb can be something of a misnomer. IMDb collects data on both film and television too. And within the database, IMDb doesn’t just maintain an entry for every television series, but actually has a record for each televison season and a record for every televsion episode. All told there are <code>29,868</code> series within IMDb represented by over <code>3,012,678</code> individual episdoes.</p>
<p>If television is collected this extensively in the database, what else does IMDb collect? What else is in the database?</p>
<p><img src="images/mp-02/1_media_types_counts.jpeg" class="img-fluid" style="width:75%; box-shadow: -1px 1px 2px rgba(0, 0, 0, 0.5); display: block; margin: auto;"></p>
<p>I’d argue the collection of Video Games will prove increasingly important as this media form grows in cultural influence. I can certainly see a future where Video Games are of equal cultural significance (…if were not at that momemnt already?) as film and TV is today.</p>
<details>
<summary>
&gt; show the code
</summary>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many films are in IMDb? </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>TITLE_BASICS <span class="sc">|&gt;</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(titleType <span class="sc">==</span> <span class="st">"movie"</span> <span class="sc">|</span> titleType <span class="sc">==</span> <span class="st">"tvMovie"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># What if we include TV Moives?   </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>TITLE_BASICS <span class="sc">|&gt;</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(titleType <span class="sc">==</span> <span class="st">"movie"</span> <span class="sc">|</span> titleType <span class="sc">==</span> <span class="st">"tvMovie"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># What if we searched for a particular HBO Moive?    </span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>TITLE_BASICS <span class="sc">|&gt;</span> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(primaryTitle <span class="sc">==</span> <span class="st">"And the Band Played On"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(titleType, primaryTitle, startYear)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># How many television series are in IMDb? </span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>TITLE_BASICS <span class="sc">|&gt;</span> </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(titleType <span class="sc">==</span> <span class="st">"tvSeries"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># How many individual episodes are collected? </span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>TITLE_EPISODES <span class="sc">|&gt;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># What are the different title types in IMDb  </span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>title_type_counts <span class="ot">&lt;-</span> TITLE_BASICS <span class="sc">|&gt;</span> </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(titleType) <span class="sc">|&gt;</span> </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's visualize the breakdown of all the different title types</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(title_type_counts, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> count, <span class="at">fill =</span> titleType)) <span class="sc">+</span> </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"IMDb Media Types and Their Counts"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_number</span>(<span class="at">scale_cut =</span> <span class="fu">cut_short_scale</span>())) <span class="sc">+</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Paired"</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</details>
</section>
<section id="years-old-you-reach-look-as-good-you-will-not" class="level3">
<h3 class="anchored" data-anchor-id="years-old-you-reach-look-as-good-you-will-not">110 years old you reach, look as good you will not</h3>
<p>IMBb is a unrivaled resource for assessing film history. And by history, there is actually some capital “H” history in IMDb.</p>
<p>IMDb counts <code>4</code> as the oldest <code>birthYear</code> for any individual in its dataset. And not just <code>4</code>, there are also <code>birthYear</code> values for <code>46</code>, <code>69</code>, <code>70</code>, <code>163</code>, <code>254</code>. As far as we know, film production is a ~150 year old technology.</p>
<p>What is going on?</p>
<p>Who was born in year <code>4</code>? Year <code>46</code>? Year <code>69</code>?</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>             primaryName</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       Flavius Josephus</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> Publius Vergilius Maro</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>                   Ovid</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  Titus Maccius Plautus</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     Lucio Anneo Seneca</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>            Cassius Dio</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>               Plutarch</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>              Suetonius</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Are you entertained? A fascinating qwirk of IMDb database is that it credits classical writers and historians for modern film production, again, proving IMDb is if nothing else an historical resource and begs the important question?</p>
<p><em>Does Zach Snyder share <a href="https://en.wikipedia.org/wiki/300_(film)">300</a> points with Plutarch?</em></p>
<p>But how about someone we know or can identify? Who is eldest creator still alive in the IMDb database? A seemingly easy way to identify “oldest creator in IMDb” would be to seek out creators with an <code>NA</code> for <code>deathYear</code>.</p>
<p>Unfortunately there are quite a few people IMDb considers living in their sunset years. IMDb idetifies 2,514 “supercentarians” - individuals 110 years of age or older - who at one time worked the film industry.</p>
<p>The <a href="https://www.grg-supercentenarians.org/">Gerontology Research Group</a> rigorously counts “supercentarians” around the world. A supercentarian is an individual equal-to, or older-than, the age of 110. At current count, there are approximately ~310 supercentarians in the world.</p>
<p>Clearly there is an issue with the IMDb dataset identifying <code>2,514</code> supercentarians in the film industry. There obviously are a multitude of deaths unreported in this data.</p>
<p>But, just because you’re old and you possibly “one-time-maybe did something in the film industry”, should anyone care? There are millions of people who throughout their lives have no-doubt been involved in at least 1 movie production in their lives. Does “old person who once worked on a forgotten independent movie no-one-saw” really communicate anything to us?</p>
<p>I posit that anyone who did anything significant in the film industry would have their <code>deathYear</code> duly reported. Therefore, let’s re-start our search and see if we can arrive at a collection of individuals “significant enough in the film industry” to warrant our interest and attention.</p>
<p>Let’s first try to identify “significant film productions” in our data.</p>
<p>I’m going to use the measure of: “if this film had a lot of people working on it, it no doubt cost a lot of money and was of notable interest to some studio or production company.” So I’m going to count the number of crew on a film and look for a threshold for top produciton.</p>
<p>Here are the quantiles for the crew counts:</p>
<pre><code>10%  20%  30%  40%  50%  60%  70%  80%  90% 100% 
10   14   16   18   19   20   21   22   24   65 </code></pre>
<p><code>90%</code> of all productions have <code>24+</code> or more crew numbers working on them. I’m going to identify any person “significant” in the films industry as someone who has worked on <code>20+</code> such productions. Sorted on <code>number_of_big_productions</code> worked on, sure enough this yields useful information:</p>
<table class="table-striped table-hover caption-top table">
<caption>Data for Big Productions by Various Individuals, Including Age</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 14%">
<col style="width: 36%">
<col style="width: 8%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>primaryName</th>
<th>birthYear</th>
<th>number_of_big_productions</th>
<th>age</th>
<th>deathYear</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Seth MacFarlane</td>
<td>1973</td>
<td>2505</td>
<td>51</td>
<td>0</td>
</tr>
<tr class="even">
<td>Dee Bradley Baker</td>
<td>1962</td>
<td>2311</td>
<td>62</td>
<td>0</td>
</tr>
<tr class="odd">
<td>Dan Castellaneta</td>
<td>1957</td>
<td>2242</td>
<td>67</td>
<td>0</td>
</tr>
<tr class="even">
<td>Hank Azaria</td>
<td>1964</td>
<td>2191</td>
<td>60</td>
<td>0</td>
</tr>
<tr class="odd">
<td>Harry Shearer</td>
<td>1943</td>
<td>2162</td>
<td>81</td>
<td>0</td>
</tr>
<tr class="even">
<td>Eric Stuart</td>
<td>1967</td>
<td>2043</td>
<td>57</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>These names are all identifiable as prominent voice actors. So with this collection of notable individuals, let’s idenfity the oldest individual in this data set:</p>
<table class="table-striped table-hover caption-top table">
<caption>What a find</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 15%">
<col style="width: 39%">
<col style="width: 8%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>primaryName</th>
<th>birthYear</th>
<th>number_of_big_productions</th>
<th>age</th>
<th>deathYear</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mel Brooks</td>
<td>1926</td>
<td>37</td>
<td>98</td>
<td>0</td>
</tr>
</tbody>
</table>
<details>
<summary>
&gt; show the code
</summary>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Who is the oldest individual in IMDb?</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(NAME_BASICS<span class="sc">$</span>birthYear, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># A birthyear of '4'! Is this a mistake? </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(NAME_BASICS<span class="sc">$</span>birthYear))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Who are these individuals? </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>NAME_BASICS <span class="sc">|&gt;</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    birthYear <span class="sc">==</span> <span class="dv">4</span> <span class="sc">|</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    birthYear <span class="sc">==</span>  <span class="dv">37</span> <span class="sc">|</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    birthYear <span class="sc">==</span>  <span class="dv">43</span> <span class="sc">|</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    birthYear <span class="sc">==</span> <span class="dv">46</span> <span class="sc">|</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    birthYear <span class="sc">==</span> <span class="dv">69</span> <span class="sc">|</span> </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    birthYear <span class="sc">==</span> <span class="dv">70</span> <span class="sc">|</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    birthYear <span class="sc">==</span> <span class="dv">163</span> <span class="sc">|</span> </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    birthYear <span class="sc">==</span> <span class="dv">254</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(primaryName)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Are there really that many 110 year-olds in this database? </span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>NAME_BASICS <span class="sc">|&gt;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(birthYear <span class="sc">&lt;=</span> <span class="dv">1914</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(deathYear)) <span class="sc">|&gt;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's count the amont of crew working for a poduction </span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>crew_counts_for_title <span class="ot">&lt;-</span> TITLE_PRINCIPALS <span class="sc">|&gt;</span> </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tconst) <span class="sc">|&gt;</span> </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">crew_members =</span> <span class="fu">n</span>()) </span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Can we identify the threshold for 'big production' by crew count?</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(crew_counts_for_title<span class="sc">$</span>crew_members, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="at">by=</span>.<span class="dv">1</span>))</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 90% of productions have 24 crew members, so let's use that threshold</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>big_productions <span class="ot">&lt;-</span> crew_counts_for_title <span class="sc">|&gt;</span> </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(crew_members <span class="sc">&gt;=</span> <span class="dv">24</span>)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Using 24 crew members as a citeria for "big production", this</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co"># identifies all of the individuals who have worked on 20 or more </span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co"># such productions, creating the criteria we're using for "significant </span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co"># individuals in film and television"</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>name_ids_in_many_big_productions <span class="ot">&lt;-</span> big_productions <span class="sc">|&gt;</span> </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(TITLE_PRINCIPALS, <span class="at">by=</span><span class="st">"tconst"</span> <span class="sc">|&gt;</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nconst) <span class="sc">|&gt;</span> </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">number_of_big_productions =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(number_of_big_productions <span class="sc">&gt;</span> <span class="dv">20</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(number_of_big_productions))</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Mathching up these ids with names </span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>names_in_many_big_productions <span class="ot">&lt;-</span> name_ids_in_many_big_productions <span class="sc">|&gt;</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(NAME_BASICS, <span class="fu">join_by</span>(nconst <span class="sc">==</span> nconst)) <span class="sc">|&gt;</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deathYear =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(deathYear), <span class="dv">0</span>, deathYear)) <span class="sc">|&gt;</span> </span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">ifelse</span>(deathYear <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">2024</span> <span class="sc">-</span> birthYear, deathYear <span class="sc">-</span> birthYear)) <span class="sc">|&gt;</span> </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(primaryName, birthYear, number_of_big_productions, age, deathYear)</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Who is the oldest individual in this data set?</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>names_in_many_big_productions <span class="sc">|&gt;</span> </span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(deathYear <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(age)) <span class="sc">|&gt;</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</details>
</section>
<section id="singular-tv-episode-rated-highly" class="level3">
<h3 class="anchored" data-anchor-id="singular-tv-episode-rated-highly">Singular TV Episode rated highly</h3>
<table class="table-striped table-hover caption-top table">
<caption>Hank!</caption>
<thead>
<tr class="header">
<th>series_title</th>
<th>episode_title</th>
<th>year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Breaking Bad</td>
<td>Ozymandias</td>
<td>2013</td>
</tr>
</tbody>
</table>
<details>
<summary>
&gt; show the code
</summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>top_episodes <span class="ot">&lt;-</span> TITLE_RATINGS <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(averageRating <span class="sc">==</span> <span class="dv">10</span> <span class="sc">&amp;</span> numVotes <span class="sc">&gt;=</span> <span class="dv">200000</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>episode_details <span class="ot">&lt;-</span> top_episodes <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(TITLE_BASICS, <span class="at">by =</span> <span class="st">"tconst"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(TITLE_EPISODES, <span class="at">by =</span> <span class="st">"tconst"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>episode_details <span class="sc">|&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(TITLE_BASICS, <span class="fu">join_by</span>(<span class="st">"parentTconst"</span> <span class="sc">==</span> <span class="st">"tconst"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">series_title =</span> primaryTitle.y, <span class="at">episode_title =</span> primaryTitle.x, <span class="at">year =</span> startYear.x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<!-- question 4 what is mark hamil most known for -->
</section>
<section id="star-wars-and-mark-hamil" class="level3">
<h3 class="anchored" data-anchor-id="star-wars-and-mark-hamil">Star Wars and Mark Hamil</h3>
<table class="table-striped table-hover caption-top table">
<caption>Data for Mark Hamill’s Star Wars Movies</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 66%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>primaryName</th>
<th>primaryTitle</th>
<th>startYear</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mark Hamill</td>
<td>Star Wars: Episode IV - A New Hope</td>
<td>1977</td>
</tr>
<tr class="even">
<td>Mark Hamill</td>
<td>Star Wars: Episode V - The Empire Strikes Back</td>
<td>1980</td>
</tr>
<tr class="odd">
<td>Mark Hamill</td>
<td>Star Wars: Episode VI - Return of the Jedi</td>
<td>1983</td>
</tr>
<tr class="even">
<td>Mark Hamill</td>
<td>Star Wars: Episode VIII - The Last Jedi</td>
<td>2017</td>
</tr>
</tbody>
</table>
<details>
<summary>
&gt; show the code
</summary>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mark_hamil_popular_works_IDs <span class="ot">&lt;-</span> NAME_BASICS <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(primaryName <span class="sc">==</span> <span class="st">"Mark Hamill"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(knownForTitles, <span class="at">sep =</span><span class="st">","</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>mark_hamil_popular_works_IDs <span class="sc">|&gt;</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(TITLE_BASICS, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"knownForTitles"</span> <span class="ot">=</span> <span class="st">"tconst"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(primaryName, primaryTitle, startYear) <span class="sc">|&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(startYear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>mark_hamil_popular_works_IDs &lt;- NAME_BASICS |&gt; filter(primaryName == “Mark Hamill”) |&gt; separate_rows(knownForTitles, sep =“,”)</p>
<!-- find parent episode -->
<!-- find all titles a person is involved with -->
<!-- assess this individual's career -->
<!-- 5 what television show with more than 12 episodes has the highest rating? -->
<p>tv_show_12_episodes &lt;- TITLE_EPISODES |&gt; group_by(parentTconst) |&gt; mutate(numberOfEpisodes = n()) |&gt;<br>
arrange(desc(numberOfEpisodes))</p>
<p>tv_show_12_episodes_high_rating_ID &lt;- tv_show_12_episodes |&gt; inner_join(TITLE_RATINGS, by = “tconst”) |&gt; select(-seasonNumber, -episodeNumber, -tconst) |&gt; group_by(parentTconst) |&gt; mutate(average_rating_for_series = mean(averageRating), total_votes = sum(numVotes)) |&gt;</p>
<p>quantile(tv_show_12_episodes_high_rating_ID$total_votes, prob = seq(0,1,.05))</p>
<p><!--       0%        5%       10%       15%       20%       25%       30%       35%       40%       45%       50%       55%       60%       65%       70%       75%       80%       85%  --> <!--    100.0    1013.0    1912.0    3124.0    4584.0    6503.0    8854.0   12202.0   15319.0   18571.3   23174.0   28807.0   36989.0   46697.0   62328.0   89750.0  126076.0  168015.0  --> <!--      90%       95%      100%  --> <!-- 268723.0  516342.0 4574462.0  --></p>
<p>tv_show_12_episodes_high_rating_titles &lt;- tv_show_12_episodes_high_rating_ID |&gt; filter(total_votes &gt; 268000) |&gt; inner_join(TITLE_BASICS, join_by(parentTconst == tconst))</p>
<p>tv_show_12_episodes_high_rating_titles &lt;- tv_show_12_episodes_high_rating_ID |&gt; filter(total_votes &gt; 268000) |&gt; inner_join(TITLE_BASICS, join_by(parentTconst == tconst)) |&gt; group_by(parentTconst, primaryTitle) |&gt;<br>
summarize(average_rating_for_series = first(average_rating_for_series), .groups = ‘drop’) |&gt;<br>
arrange(desc(average_rating_for_series))</p>
<p>print(tv_show_12_episodes_high_rating_titles, n = 50)</p>
<p><!--   parentTconst primaryTitle                      average_rating_for_series --> <!--   <chr>        <chr>                                                 <dbl> --> <!-- 1 tt7366338    Chernobyl                                              9.52 --> <!-- 2 tt2560140    Attack on Titan                                        9.02 --> <!-- 3 tt0903747    Breaking Bad                                           8.96 --> <!-- 4 tt5753856    Dark                                                   8.89 --> <!-- 5 tt4158110    Mr. Robot                                              8.89 --> <!-- 6 tt3322312    Daredevil                                              8.84 --> <!-- 7 tt1839578    Person of Interest                                     8.80 --></p>
<!-- The TV series Happy Days (1974-1984) gives us the common idiom “jump the shark”. The phrase comes from a controversial fifth season episode (aired in 1977) in which a lead character literally jumped over a shark on water skis. Idiomatically, it is used to refer to the moment when a once-great show becomes ridiculous and rapidly looses quality. -->
<!-- Is it true that episodes from later seasons of Happy Days have lower average ratings than the early seasons? -->
<!-- make sure TITLE_BASICS and working movie_lens data_set have similar IMDb IDs -->
<p>title_basics_movie_lens_id &lt;- TITLE_BASICS |&gt; mutate(IMDbId = as.numeric(substring(tconst, 3)))</p>
<!-- merge the two data sets, make sure to create a year for when the review was posted -->
<p>movie_lens_and_IMDb &lt;- title_basics_movie_lens_id |&gt; inner_join(movie_lens_filtered_reviews_IMDb, by = “IMDbId”) |&gt; select(-isAdult, -endYear, -runtimeMinutes, -tmdbId, -titleType) |&gt; mutate(yearReview = year(as.POSIXct(timestamp, origin=“1970-01-01”)))</p>
<!-- now take out all reviews that were  -->
<p>movie_lens_and_IMDb_5_year_reviews &lt;- movie_lens_and_IMDb |&gt; filter(yearReview - startYear &gt;= 5) |&gt; group_by(IMDbId, primaryTitle, startYear) |&gt; summarize(avg_review = mean(rating)) |&gt; select(-IMDbId) |&gt; arrange(desc(avg_review))</p>
<p>print(movie_lens_and_IMDb_5_year_reviews, n=50)</p>
<p>min(movie_lens_and_IMDb$yearReview) <!-- [1] 1995 --></p>
<!--     IMDbId primaryTitle                                                         startYear avg_review -->
<!--      <dbl> <chr>                                                                    <dbl>      <dbl> -->
<!--  1  795176 Planet Earth                                                              2006       4.44 -->
<!--  2  185906 Band of Brothers                                                          2001       4.43 -->
<!--  3  111161 The Shawshank Redemption                                                  1994       4.39 -->
<!--  4 5491994 Planet Earth II                                                           2016       4.33 -->
<!--  5   68646 The Godfather                                                             1972       4.32 -->
<!--  6  278784 Northwest Passage                                                         1989       4.30 -->
<!--  7 3718778 Over the Garden Wall                                                      2014       4.27 -->
<!--  8   50083 12 Angry Men                                                              1957       4.27 -->
<!--  9   71562 The Godfather Part II                                                     1974       4.26 -->
<!-- 10   47478 Seven Samurai                                                             1954       4.25 -->
<!-- 11  296310 The Blue Planet                                                           2001       4.25 -->
<!-- 12  114814 The Usual Suspects                                                        1995       4.25 -->
<!-- 13 2654430 Whiplash                                                                  2013       4.24 -->
<!-- 14  137523 Fight Club                                                                1999       4.24 -->
<!-- 15  110912 Pulp Fiction                                                              1994       4.24 -->
<!-- 16   47396 Rear Window                                                               1954       4.23 -->
<!-- 17  245429 Spirited Away                                                             2001       4.21 -->
<!-- 18   73486 One Flew Over the Cuckoo's Nest                                           1975       4.20 -->
<!-- 19   57012 Dr. Strangelove or: How I Learned to Stop Worrying and Love the Bomb      1964       4.20 -->
<!-- 20  816692 Interstellar                                                              2014       4.20 -->
<!-- 21   43014 Sunset Boulevard                                                          1950       4.20 -->
<!-- 22   34583 Casablanca                                                                1942       4.19 -->
<!-- 23   56058 Harakiri                                                                  1962       4.19 -->
<!-- 24   99685 Goodfellas                                                                1990       4.19 -->
<!-- 25   53125 North by Northwest                                                        1959       4.19 -->
<!-- 26  108052 Schindler's List                                                          1993       4.19 -->
<!-- 27   41959 The Third Man                                                             1949       4.18 -->
<!-- 28   36775 Double Indemnity                                                          1944       4.18 -->
<!-- 29 6769208 Blue Planet II                                                            2017       4.18 -->
<!-- 30   50825 Paths of Glory                                                            1957       4.18 -->
<!-- 31  405094 The Lives of Others                                                       2006       4.18 -->
<!-- 32 2582802 Whiplash                                                                  2014       4.18 -->
<!-- 33  119698 Princess Mononoke                                                         1997       4.18 -->
<!-- 34   91251 Come and See                                                              1985       4.17 -->
<!-- 35   55630 Yojimbo                                                                   1961       4.17 -->
<!-- 36   57565 High and Low                                                              1963       4.16 -->
<!-- 37 4299972 The Jinx: The Life and Deaths of Robert Durst                             2015       4.16 -->
<!-- 38 4633694 Spider-Man: Into the Spider-Verse                                         2018       4.16 -->
<!-- 39  317248 City of God                                                               2002       4.16 -->
<!-- 40   96283 My Neighbor Totoro                                                        1988       4.16 -->
<!-- 41   42192 All About Eve                                                             1950       4.16 -->
<!-- 42 5311514 Your Name.                                                                2016       4.16 -->
<!-- 43 1375666 Inception                                                                 2010       4.16 -->
<!-- 44   71315 Chinatown                                                                 1974       4.15 -->
<!-- 45   22100 M                                                                         1931       4.15 -->
<!-- 46   38355 The Big Sleep                                                             1946       4.15 -->
<!-- 47  110413 Léon: The Professional                                                    1994       4.15 -->
<!-- 48  468569 The Dark Knight                                                           2008       4.15 -->
<!-- 49  102926 The Silence of the Lambs                                                  1991       4.15 -->
<!-- 50   38787 Notorious                                                                 1946       4.15 -->
<p>movie_lens_and_IMDb_year_review &lt;- movie_lens_and_IMDb |&gt; group_by(IMDbId, primaryTitle, startYear) |&gt; summarize(avg_review = mean(rating)) |&gt; arrange(desc(avg_review))</p>
<p>print(movie_lens_and_IMDb_year_review, n = 50)</p>
<p><!--    IMDbId primaryTitle                                                         startYear avg_review --> <!--     <dbl> <chr>                                                                    <dbl>      <dbl> --> <!-- 1 5491994 Planet Earth II                                                           2016       4.45 --> <!-- 2  795176 Planet Earth                                                              2006       4.44 --> <!-- 3  185906 Band of Brothers                                                          2001       4.43 --> <!-- 4  111161 The Shawshank Redemption                                                  1994       4.40 --> <!-- 5   68646 The Godfather                                                             1972       4.32 --> <!-- 6 6751668 Parasite                                                                  2019       4.31 --> <!-- 7 6769208 Blue Planet II                                                            2017       4.30 --> <!-- 8  278784 Northwest Passage                                                         1989       4.30 --></p>
<p>polarizing_films &lt;- movie_lens_and_IMDb |&gt; group_by(IMDbId, primaryTitle, startYear, genres) |&gt; summarise(mean_rating = mean(rating), sd_rating = sd(rating), num_ratings = n()) |&gt; arrange(desc(sd_rating)) |&gt; select(-IMDbId)</p>
<p>polarizing_films</p>
<p>polarizing_films &lt;- movie_lens_and_IMDb |&gt; group_by(movieId, primaryTitle, startYear, genres) |&gt; summarise(mean_rating = mean(rating), iqr_rating = IQR(rating), num_ratings = n()) |&gt; arrange(desc(iqr_rating))</p>
<p>polarizing_films &lt;- movie_lens_and_IMDb |&gt; group_by(movieId, primaryTitle, startYear, genres) |&gt; summarise(mean_rating = mean(rating), var_rating = var(rating), num_ratings = n()) |&gt; arrange(desc(var_rating))</p>
<!-- KAGGLE -->
<p>movie_lens_and_IMDb_and_kaggle &lt;- movie_lens_and_IMDb |&gt; inner_join(KAGGLE_DATA, join_by(tconst == IMDb_id))</p>
<p>movie_lens_and_IMDb_and_kaggle</p>
<p>get_dollar_adjusted_value &lt;- function(budget, year){ return (budget * cpi_named_vector[as.character(2024)]/cpi_named_vector[as.character(year)]) }</p>
<p>votes_budget &lt;- movie_lens_and_IMDb_and_kaggle |&gt; group_by(IMDbId, primaryTitle, budget, startYear, revenue) |&gt; summarize(num_votes = n()) |&gt; mutate(adjusted_budget = get_dollar_adjusted_value(budget, startYear), adjusted_profit = get_dollar_adjusted_value(revenue, startYear) - get_dollar_adjusted_value(budget, startYear) )</p>
<p>model_profit &lt;- lm(votes_budget<span class="math inline">\(num_votes ~  votes_budget\)</span>adjusted_profit)</p>
<p>reg_line &lt;- function(x_val, model){ return(coef(model)[1] + coef(model)[2] * x_val) }</p>
<p>votes_budget_profit &lt;- votes_budget |&gt; mutate(popularity_over_profit = num_votes - reg_line(adjusted_profit, model_profit)) |&gt; arrange(desc(popularity_over_profit))</p>
<!-- why not working? -->
<p>ggplot(data = votes_budget_profit, aes(x = adjusted_profit, y = num_votes )) + geom_point(alpha = 0.1) + geom_smooth(method=“lm”, se=FALSE)</p>
<p>model_budget &lt;- lm(votes_budget<span class="math inline">\(num_votes ~  votes_budget\)</span>adjusted_budget)</p>
<p>votes_budget_budget &lt;- votes_budget |&gt; mutate(popularity_over_budget = num_votes - reg_line(adjusted_budget, model_profit)) |&gt; arrange(desc(popularity_over_budget))</p>
<p>print(votes_budget_budget, n =100)</p>
<!-- expensive films -->
<p>votes_budget |&gt; arrange(desc(adjusted_budget)) |&gt; print(n = 100)</p>
<p>top_500_polarizing_films &lt;- head(polarizing_films, 500)</p>
<p>top_500_polarizing_films_w_budget &lt;- top_500_polarizing_films |&gt; inner_join(KAGGLE_DATA, join_by(IMDbId == IMDb_id))</p>
<p>top_500_polarizing_films_w_budget</p>
</section>
</section>
<section id="appendixA" class="level2">
<h2 class="anchored" data-anchor-id="appendixA">Appendix A</h2>
<section id="how-data-was-loaded" class="level3">
<h3 class="anchored" data-anchor-id="how-data-was-loaded">How Data Was Loaded</h3>
<p>In this section, I describe how the data was loaded into the project.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>DATA_FOLDER <span class="ot">&lt;-</span> <span class="st">"data/mp02/"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>get_IMDb_file <span class="ot">&lt;-</span> <span class="cf">function</span>(fname){</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">as.data.frame</span>(readr<span class="sc">::</span><span class="fu">read_csv</span>(fname, <span class="at">lazy=</span><span class="cn">FALSE</span>))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>create_file_ext <span class="ot">&lt;-</span> <span class="cf">function</span>(fname){</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">paste0</span>(DATA_FOLDER, fname)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># IMDb DATA</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>NAME_BASICS <span class="ot">&lt;-</span> <span class="fu">get_IMDb_file</span>(<span class="fu">create_file_ext</span>(<span class="st">"NAME_BASICS.csv"</span>))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>TITLE_RATINGS <span class="ot">&lt;-</span> <span class="fu">get_IMDb_file</span>(<span class="fu">create_file_ext</span>(<span class="st">"TITLE_RATINGS.csv"</span>))</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>TITLE_BASICS <span class="ot">&lt;-</span> <span class="fu">get_IMDb_file</span>(<span class="fu">create_file_ext</span>(<span class="st">"TITLE_BASICS.csv"</span>))</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>TITLE_CREW <span class="ot">&lt;-</span> <span class="fu">get_IMDb_file</span>(<span class="fu">create_file_ext</span>(<span class="st">"TITLE_CREW.csv"</span>))</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>TITLE_EPISODES <span class="ot">&lt;-</span> <span class="fu">get_IMDb_file</span>(<span class="fu">create_file_ext</span>(<span class="st">"TITLE_EPISODES.csv"</span>))</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>TITLE_PRINCIPALS <span class="ot">&lt;-</span> <span class="fu">get_IMDb_file</span>(<span class="fu">create_file_ext</span>(<span class="st">"TITLE_PRINCIPALS.csv"</span>))</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>NAME_BASICS <span class="ot">&lt;-</span> NAME_BASICS <span class="sc">|&gt;</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">birthYear =</span> <span class="fu">as.numeric</span>(birthYear),</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">deathYear =</span> <span class="fu">as.numeric</span>(deathYear))</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>TITLE_RATINGS <span class="ot">&lt;-</span> TITLE_RATINGS <span class="sc">|&gt;</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">averageRating =</span> <span class="fu">as.numeric</span>(averageRating),</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">numVotes =</span> <span class="fu">as.numeric</span>(numVotes))</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>TITLE_BASICS <span class="ot">&lt;-</span> TITLE_BASICS <span class="sc">|&gt;</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">isAdult =</span> <span class="fu">as.logical</span>(isAdult),</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>           <span class="at">runtimeMinutes =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"[^0-9]"</span>, runtimeMinutes), <span class="cn">NA</span>, <span class="fu">as.numeric</span>(runtimeMinutes)))</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co"># MOVIE LENS</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>MOVIE_LENS_RATINGS <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/mp02/ml-32m/ratings.csv"</span>)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>MOVIE_LENS_LINKS <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/mp02/ml-32m/links.csv"</span>)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>movie_lens_ratings_merged <span class="ot">&lt;-</span> MOVIE_LENS_RATINGS <span class="sc">|&gt;</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(movieId) <span class="sc">|&gt;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">count_reviews =</span> <span class="fu">n</span>())</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="co"># KAGGLE</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>KAGGLE_DATA <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/mp02/KAGGLE_DATA.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">budget =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(budget), <span class="dv">0</span>, <span class="fu">parse_number</span>(budget)))</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="co"># CPI</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>HISTORICAL_CPI <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/mp02/HISTORICAL_CPI.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">substring</span>(DATE,<span class="dv">1</span>,<span class="dv">4</span>))</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>cpi_named_vector <span class="ot">&lt;-</span> <span class="fu">setNames</span>(HISTORICAL_CPI<span class="sc">$</span>CPIAUCNS, HISTORICAL_CPI<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>head(names_in_many_big_productions) <!-- quantile(movies_with_ratings_merged$count_reviews, probs=seq(0,1, by = 0.025)) --> <!-- 95% of reviews have 1000 reviews or less... --></p>
<!-- max(movies_with_ratings_merged$movieId) -->
<!-- 292757 -->
<!-- MOVIE LENS -->
<p>movies_meeting_review_threshold &lt;- movies_lens_ratings_merged |&gt; filter(count_reviews &gt;= 1000) |&gt; pull(movieId)</p>
<p>filtered_reviews &lt;- MOVIE_LENS_RATINGS |&gt; filter(movieId %in% movies_meeting_review_threshold)</p>
<p>movie_lens__IMDb &lt;- filtered_reviews |&gt; inner_join(MOVIE_LENS_LINKS, by = “movieId”)</p>
<details>
<summary>
&gt; show the code
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>hello <span class="ot">&lt;-</span> <span class="st">"hello"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<!-- number of movies -->
<p>When we say “movie” we often think of “what is opening this Friday” and with it: “what film will win the weekend box office?”</p>
<p>If we look at the Kaggle Movie Dataset, we see</p>
<p>quantile(KAGGLE_DATA$revenue, probs = seq(0,1,.05), na.rm=TRUE)</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jasonamey\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>